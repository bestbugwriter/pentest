#!/usr/bin/python

import re
from scapy.all import *

def get_cookie(pkt):
    if pkt.haslayer(TCP):
        tcp = pkt.getlayer(TCP)
        if tcp.dport == 80:
            m = re.search("Cookie:.*", str(tcp.payload))
            if m:
                return m

def save_cookie(pkt, f):
	c = get_cookie(pkt)
	if c:
		f.write(str(c.group()))

def search_cookie_from_pcap(pcapfile, filename):
	try:
		pkts = rdpcap(pcapfile)
		print "[+]" + str(pkts.sessions)
		with open(filename, "wb") as f:
			for pkt in pkts:
				save_cookie(pkt, f)

	except Exception , e:
		print e
		return

def save_cookie_pkt(pkt)
	c = get_cookie(pkt)
	if c:
		pcap.append(pkt)

pcap = []
def save_cookie_file(pcapfile)
	sniff(filter="tcp and port 80", prn=save_cookie)
	wrpcap(pcapfile, pcap)


	
		
